From 1b921aef062d343eabe03081f76ff32d1d1a7ed0 Mon Sep 17 00:00:00 2001
From: Zygmunt Krynicki <me@zygoon.pl>
Date: Wed, 17 Aug 2016 18:37:00 +0200
Subject: [PATCH] Add systemd units for Fedora

Signed-off-by: Zygmunt Krynicki <me@zygoon.pl>
---
 snapd.refresh.service |  8 ++++++++
 snapd.refresh.timer   | 11 +++++++++++
 snapd.service         | 12 ++++++++++++
 snapd.socket          | 12 ++++++++++++
 4 files changed, 43 insertions(+)
 create mode 100644 snapd.refresh.service
 create mode 100644 snapd.refresh.timer
 create mode 100644 snapd.service
 create mode 100644 snapd.socket

diff --git a/snapd.refresh.service b/snapd.refresh.service
new file mode 100644
index 0000000..deba78a
--- /dev/null
+++ b/snapd.refresh.service
@@ -0,0 +1,8 @@
+[Unit]
+Description=Automatically refresh installed snaps
+After=network.target
+Documentation=man:snap(1)
+
+[Service]
+Type=oneshot
+ExecStart=/usr/bin/snap refresh
diff --git a/snapd.refresh.timer b/snapd.refresh.timer
new file mode 100644
index 0000000..82c28b1
--- /dev/null
+++ b/snapd.refresh.timer
@@ -0,0 +1,11 @@
+[Unit]
+Description=Timer to automatically refresh installed snaps
+
+[Timer]
+OnCalendar=23,05,11,17:00
+RandomizedDelaySec=6h
+AccuracySec=10min
+Persistent=true
+
+[Install]
+WantedBy=multi-user.target
diff --git a/snapd.service b/snapd.service
new file mode 100644
index 0000000..2c41943
--- /dev/null
+++ b/snapd.service
@@ -0,0 +1,12 @@
+[Unit]
+Description=Snappy daemon
+Before=snapd.frameworks-pre.target
+Requires=snapd.socket
+
+[Service]
+ExecStart=/usr/libexec/snapd/snapd
+ExecStartPre=/usr/sbin/modprobe squashfs
+EnvironmentFile=-/etc/sysconfig/snapd
+
+[Install]
+WantedBy=multi-user.target
diff --git a/snapd.socket b/snapd.socket
new file mode 100644
index 0000000..c2a3748
--- /dev/null
+++ b/snapd.socket
@@ -0,0 +1,12 @@
+[Unit]
+Description=Socket activation for snappy daemon
+
+[Socket]
+ListenStream=/run/snapd.socket
+SocketMode=0666
+# these are the defaults, but can't hurt to specify them anyway:
+SocketUser=root
+SocketGroup=root
+
+[Install]
+WantedBy=sockets.target
-- 
2.7.4

